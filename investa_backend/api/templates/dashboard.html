{% extends 'base.html' %}

{% block title %}Dashboard - Investa Console{% endblock %}

{% block extra_css %}
<style>
  /* Dashboard specific styles */
  .stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 16px;
    margin-bottom: 24px;
  }
  
  .stat-card {
    background: linear-gradient(135deg, var(--brand), var(--brand-600));
    color: white;
    padding: 20px;
    border-radius: 16px;
    text-align: center;
    box-shadow: 0 4px 12px rgba(79, 70, 229, 0.2);
    transition: transform 0.2s ease;
  }
  
  .stat-card:hover {
    transform: translateY(-2px);
  }
  
  .stat-number {
    font-size: 32px;
    font-weight: 800;
    margin-bottom: 8px;
  }
  
  .stat-label {
    font-size: 14px;
    opacity: 0.9;
  }
  
  .feature-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 20px;
    margin-bottom: 24px;
  }
  
  .feature-card {
    background: white;
    border: 1px solid var(--border);
    border-radius: 16px;
    padding: 24px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.04);
    transition: all 0.2s ease;
  }
  
  .feature-card:hover {
    box-shadow: 0 4px 16px rgba(0,0,0,0.1);
    transform: translateY(-2px);
  }
  
  .feature-icon {
    width: 48px;
    height: 48px;
    background: linear-gradient(135deg, var(--brand), var(--brand-600));
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    margin-bottom: 16px;
    font-size: 24px;
    color: white;
  }
  
  .feature-title {
    font-size: 18px;
    font-weight: 700;
    margin-bottom: 8px;
    color: var(--ink);
  }
  
  .feature-desc {
    color: var(--muted);
    line-height: 1.5;
    margin-bottom: 16px;
  }
  
  .api-section {
    background: #f8fafc;
    border: 1px solid var(--border);
    border-radius: 16px;
    padding: 24px;
    margin-bottom: 24px;
  }
  
  .api-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 16px;
    margin-top: 16px;
  }
  
  .api-card {
    background: white;
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 16px;
    transition: all 0.2s ease;
  }
  
  .api-card:hover {
    border-color: var(--brand);
    box-shadow: 0 2px 8px rgba(79, 70, 229, 0.1);
  }
  
  .api-method {
    display: inline-block;
    padding: 4px 8px;
    border-radius: 6px;
    font-size: 11px;
    font-weight: 600;
    text-transform: uppercase;
    margin-bottom: 8px;
  }
  
  .api-method.get { background: #dcfce7; color: #166534; }
  .api-method.post { background: #dbeafe; color: #1e40af; }
  .api-method.put { background: #fef3c7; color: #92400e; }
  .api-method.delete { background: #fee2e2; color: #991b1b; }
  
  .api-endpoint {
    font-family: 'Monaco', 'Menlo', monospace;
    font-size: 13px;
    color: var(--ink);
    margin-bottom: 8px;
  }
  
  .api-desc {
    font-size: 12px;
    color: var(--muted);
  }
  
  .quick-actions {
    display: flex;
    gap: 12px;
    flex-wrap: wrap;
    margin-bottom: 24px;
  }
  
  .quick-btn {
    background: white;
    border: 2px solid var(--border);
    color: var(--ink);
    padding: 12px 20px;
    border-radius: 12px;
    text-decoration: none;
    font-weight: 600;
    transition: all 0.2s ease;
    display: flex;
    align-items: center;
    gap: 8px;
  }
  
  .quick-btn:hover {
    border-color: var(--brand);
    color: var(--brand);
    transform: translateY(-1px);
  }
  
  .quick-btn.primary {
    background: var(--brand);
    color: white;
    border-color: var(--brand);
  }
  
  .quick-btn.primary:hover {
    background: var(--brand-600);
    color: white;
  }
  
  .status-indicator {
    display: inline-block;
    width: 8px;
    height: 8px;
    border-radius: 50%;
    margin-right: 8px;
  }
  
  .status-online { background: #10b981; }
  .status-offline { background: #ef4444; }
  
  .recent-activity {
    background: white;
    border: 1px solid var(--border);
    border-radius: 16px;
    padding: 24px;
  }
  
  .activity-item {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 12px 0;
    border-bottom: 1px solid var(--border);
  }
  
  .activity-item:last-child {
    border-bottom: none;
  }
  
  .activity-icon {
    width: 32px;
    height: 32px;
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 14px;
    color: white;
  }
  
  .activity-content {
    flex: 1;
  }
  
  .activity-title {
    font-weight: 600;
    color: var(--ink);
    margin-bottom: 2px;
  }
  
  .activity-time {
    font-size: 12px;
    color: var(--muted);
  }
  
  .form-section {
    background: white;
    border: 1px solid var(--border);
    border-radius: 16px;
    padding: 24px;
    margin-bottom: 24px;
  }
  
  .form-section h3 {
    margin-bottom: 16px;
    display: flex;
    align-items: center;
    gap: 8px;
  }
  
  .form-section h3::before {
    content: "üîê";
    font-size: 20px;
  }
  
  .form-row {
    margin-bottom: 16px;
  }
  
  .form-row label {
    display: block;
    margin-bottom: 6px;
    font-weight: 600;
    color: var(--ink);
  }
  
  .form-row input {
    width: 100%;
    padding: 12px 16px;
    border: 2px solid var(--border);
    border-radius: 10px;
    font-size: 14px;
    transition: border-color 0.2s ease;
  }
  
  .form-row input:focus {
    border-color: var(--brand);
    outline: none;
  }
  
  .form-row button {
    width: 100%;
    padding: 12px 16px;
    background: var(--brand);
    color: white;
    border: none;
    border-radius: 10px;
    font-weight: 600;
    cursor: pointer;
    transition: background 0.2s ease;
  }
  
  .form-row button:hover {
    background: var(--brand-600);
  }
  
  .output-section {
    margin-top: 16px;
  }
  
  .output-section pre {
    background: #0f172a;
    color: #e2e8f0;
    padding: 16px;
    border-radius: 10px;
    font-size: 12px;
    max-height: 200px;
    overflow-y: auto;
  }
  
  .welcome-section {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 40px;
    border-radius: 20px;
    margin-bottom: 30px;
    text-align: center;
  }
  
  .welcome-title {
    font-size: 36px;
    font-weight: 800;
    margin-bottom: 16px;
  }
  
  .welcome-subtitle {
    font-size: 18px;
    opacity: 0.9;
    margin-bottom: 24px;
    line-height: 1.6;
  }
  
  .welcome-actions {
    display: flex;
    gap: 16px;
    justify-content: center;
    flex-wrap: wrap;
  }
  
  .welcome-btn {
    background: rgba(255,255,255,0.2);
    color: white;
    border: 2px solid rgba(255,255,255,0.3);
    padding: 14px 28px;
    border-radius: 12px;
    font-weight: 600;
    text-decoration: none;
    transition: all 0.2s ease;
  }
  
  .welcome-btn:hover {
    background: rgba(255,255,255,0.3);
    border-color: rgba(255,255,255,0.5);
    transform: translateY(-2px);
  }
</style>
{% endblock %}

{% block content %}
<!-- Welcome section -->
<div class="welcome-section">
  <h1 class="welcome-title">üöÄ Investa Console</h1>
  <p class="welcome-subtitle">Your comprehensive development dashboard for testing APIs, managing data, and monitoring the Investa learning platform</p>
  <div class="welcome-actions">
    <a href="{% url 'database' %}" class="welcome-btn">üìä Explore Database</a>
    <a href="{% url 'admin:index' %}" class="welcome-btn">‚öôÔ∏è Admin Panel</a>
  </div>
</div>

<!-- Quick Stats -->
<div class="stats-grid">
  <div class="stat-card">
    <div class="stat-number">12</div>
    <div class="stat-label">Active Courses</div>
  </div>
  <div class="stat-card">
    <div class="stat-number">156</div>
    <div class="stat-label">Total Users</div>
  </div>
  <div class="stat-card">
    <div class="stat-number">89</div>
    <div class="stat-label">Lessons Created</div>
  </div>
  <div class="stat-card">
    <div class="stat-number">24</div>
    <div class="stat-label">API Endpoints</div>
  </div>
</div>

<!-- Quick Actions -->
<div class="quick-actions">
  <a href="{% url 'database' %}" class="quick-btn">
    üìä Database Explorer
  </a>
  <a href="{% url 'admin:index' %}" class="quick-btn">
    ‚öôÔ∏è Admin Panel
  </a>
  <a href="/api/" class="quick-btn">
    üîó API Root
  </a>
  <a href="/api/languages/" class="quick-btn">
    üåç Languages
  </a>
  <a href="/api/courses/" class="quick-btn">
    üìö Courses
  </a>
  <a href="/api/lessons/" class="quick-btn">
    üìñ Lessons
  </a>
  <a href="/api/user-lesson-progress/" class="quick-btn">
    ‚úÖ Lesson Progress
  </a>
  <a href="/api/profiles/" class="quick-btn">
    üë• Profiles
  </a>
</div>

<!-- Feature Cards -->
<div class="feature-grid">
  <div class="feature-card">
    <div class="feature-icon">üîê</div>
    <div class="feature-title">Authentication</div>
    <div class="feature-desc">Test user registration, login, and token-based authentication with our secure API endpoints.</div>
    <div class="status-indicator status-online"></div>
    <span style="font-size: 12px; color: var(--muted);">System Online</span>
  </div>
  
  <div class="feature-card">
    <div class="feature-icon">üìä</div>
    <div class="feature-title">Data Management</div>
    <div class="feature-desc">Explore and manage your database with our interactive database explorer and admin tools.</div>
    <div class="status-indicator status-online"></div>
    <span style="font-size: 12px; color: var(--muted);">Database Connected</span>
  </div>
  
  <div class="feature-card">
    <div class="feature-icon">üéØ</div>
    <div class="feature-title">API Testing</div>
    <div class="feature-desc">Test all REST API endpoints directly from the dashboard with real-time response preview.</div>
    <div class="status-indicator status-online"></div>
    <span style="font-size: 12px; color: var(--muted);">API Ready</span>
  </div>
</div>

<!-- API Documentation Section -->
<div class="api-section">
  <h3 style="margin-bottom: 16px; color: var(--ink);">üîó Available API Endpoints</h3>
  <div class="api-grid">
    <div class="api-card">
      <div class="api-method get">GET</div>
      <div class="api-endpoint">/api/languages/</div>
      <div class="api-desc">Get all available languages</div>
    </div>
    
    <div class="api-card">
      <div class="api-method get">GET</div>
      <div class="api-endpoint">/api/courses/</div>
      <div class="api-desc">List all courses (auth required)</div>
    </div>
    
    <div class="api-card">
      <div class="api-method get">GET</div>
      <div class="api-endpoint">/api/profiles/</div>
      <div class="api-desc">User profiles (auth required)</div>
    </div>
    
    <div class="api-card">
      <div class="api-method post">POST</div>
      <div class="api-endpoint">/api/auth/register/</div>
      <div class="api-desc">Register new user</div>
    </div>
    
    <div class="api-card">
      <div class="api-method post">POST</div>
      <div class="api-endpoint">/api/auth/login/</div>
      <div class="api-desc">User authentication</div>
    </div>
    
    <div class="api-card">
      <div class="api-method get">GET</div>
      <div class="api-endpoint">/api/auth/me/</div>
      <div class="api-desc">Get current user (auth required)</div>
    </div>
  </div>
</div>

<!-- Authentication Forms -->
<div class="grid-2">
  <div class="form-section">
    <h3>Create Account</h3>
    <form onsubmit="registerUser(event)">
      <div class="form-row">
        <label for="fullname">Full Name</label>
        <input type="text" id="fullname" name="fullname" placeholder="Enter your full name" required />
      </div>
      <div class="form-row">
        <label for="email">Email Address</label>
        <input type="email" id="email" name="email" placeholder="Enter your email" required />
      </div>
      <div class="form-row">
        <label for="password">Password</label>
        <input type="password" id="password" name="password" placeholder="Enter your password" required />
      </div>
      <div class="form-row">
        <button type="submit">Create Account</button>
      </div>
    </form>
    <div class="output-section">
      <pre id="registerOutput"></pre>
    </div>
  </div>

  <div class="form-section">
    <h3>Login</h3>
    <form onsubmit="loginUser(event)">
      <div class="form-row">
        <label for="username">Username/Email</label>
        <input type="text" id="username" name="username" placeholder="Enter username or email" required />
      </div>
      <div class="form-row">
        <label for="loginPassword">Password</label>
        <input type="password" id="loginPassword" name="password" placeholder="Enter your password" required />
      </div>
      <div class="form-row">
        <button type="submit">Login</button>
      </div>
    </form>
    <div class="output-section">
      <pre id="loginOutput"></pre>
    </div>
  </div>
</div>

<!-- Recent Activity -->
<div class="recent-activity">
  <h3 style="margin-bottom: 16px; color: var(--ink);">üìà Recent Activity</h3>
  <div class="activity-item">
    <div class="activity-icon" style="background: #10b981;">üë§</div>
    <div class="activity-content">
      <div class="activity-title">New user registered</div>
      <div class="activity-time">2 minutes ago</div>
    </div>
  </div>
  <div class="activity-item">
    <div class="activity-icon" style="background: #3b82f6;">üìö</div>
    <div class="activity-content">
      <div class="activity-title">Course "Advanced Trading" created</div>
      <div class="activity-time">15 minutes ago</div>
    </div>
  </div>
  <div class="activity-item">
    <div class="activity-icon" style="background: #f59e0b;">üéØ</div>
    <div class="activity-content">
      <div class="activity-title">Quiz "Market Fundamentals" completed</div>
      <div class="activity-time">1 hour ago</div>
    </div>
  </div>
  <div class="activity-item">
    <div class="activity-icon" style="background: #8b5cf6;">üí∞</div>
    <div class="activity-content">
      <div class="activity-title">Trading simulation updated</div>
      <div class="activity-time">2 hours ago</div>
    </div>
  </div>
</div>

<!-- System Configuration -->
<div class="card" style="margin-top: 24px;">
  <h3 style="margin-bottom: 16px;">‚öôÔ∏è System Configuration</h3>
  <div class="row">
    <label for="baseUrl">API Base URL:</label>
    <input id="baseUrl" value="http://127.0.0.1:8000/api" style="min-width: 320px;" />
    <span class="pill">üí° Android emulator: http://10.0.2.2:8000/api</span>
  </div>
  <div style="margin-top: 12px; font-size: 12px; color: var(--muted);">
    <strong>Environment:</strong> Development | <strong>Database:</strong> SQLite | <strong>API Version:</strong> v1.0
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
  async function registerUser(evt){
    evt.preventDefault();
    const form = evt.target;
    const email = form.email.value.trim();
    const password = form.password.value;
    const fullName = form.fullname.value.trim();
    const [first_name, ...last_parts] = fullName.split(/\s+/);
    const last_name = last_parts.join(' ');
    const payload = { username: email, email, password, confirm_password: password, first_name, last_name };
    const base = document.getElementById('baseUrl').value || 'http://127.0.0.1:8000/api';
    
    try {
      const res = await fetch(base + '/auth/register/', { 
        method:'POST', 
        headers: { 'Content-Type':'application/json' }, 
        body: JSON.stringify(payload) 
      });
      const data = await res.json().catch(()=>({}));
      document.getElementById('registerOutput').textContent = JSON.stringify({status: res.status, data}, null, 2);
      
      if (res.ok) {
        document.getElementById('registerOutput').style.color = '#10b981';
      } else {
        document.getElementById('registerOutput').style.color = '#ef4444';
      }
    } catch (error) {
      document.getElementById('registerOutput').textContent = `Error: ${error.message}`;
      document.getElementById('registerOutput').style.color = '#ef4444';
    }
  }
  
  async function loginUser(evt){
    evt.preventDefault();
    const form = evt.target;
    const username = form.username.value.trim();
    const password = form.password.value;
    const base = document.getElementById('baseUrl').value || 'http://127.0.0.1:8000/api';
    
    try {
      const res = await fetch(base + '/auth/login/', { 
        method:'POST', 
        headers: { 'Content-Type':'application/json' }, 
        body: JSON.stringify({username, password}) 
      });
      const data = await res.json().catch(()=>({}));
      document.getElementById('loginOutput').textContent = JSON.stringify({status: res.status, data}, null, 2);
      
      if (res.ok) {
        document.getElementById('loginOutput').style.color = '#10b981';
      } else {
        document.getElementById('loginOutput').style.color = '#ef4444';
      }
    } catch (error) {
      document.getElementById('loginOutput').textContent = `Error: ${error.message}`;
      document.getElementById('loginOutput').style.color = '#ef4444';
    }
  }

  // Add some interactive features
  document.addEventListener('DOMContentLoaded', function() {
    // Animate stats on load
    const statNumbers = document.querySelectorAll('.stat-number');
    statNumbers.forEach(stat => {
      const finalValue = parseInt(stat.textContent);
      let currentValue = 0;
      const increment = finalValue / 20;
      const timer = setInterval(() => {
        currentValue += increment;
        if (currentValue >= finalValue) {
          stat.textContent = finalValue;
          clearInterval(timer);
        } else {
          stat.textContent = Math.floor(currentValue);
        }
      }, 50);
    });

    // Add hover effects to API cards
    const apiCards = document.querySelectorAll('.api-card');
    apiCards.forEach(card => {
      card.addEventListener('click', function() {
        const endpoint = this.querySelector('.api-endpoint').textContent;
        window.open(endpoint, '_blank');
      });
    });
  });
</script>
{% endblock %}


